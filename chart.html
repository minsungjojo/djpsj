<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApexCharts를 사용한 BTC 차트</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>
    <div id="btcChart"></div>

    <script>
        // 11.txt에서 데이터를 가져와 파싱하는 함수
        async function fetchData() {
            try {
                const response = await fetch('11.txt');
                const textData = await response.text();
                
                // 파일 내용을 줄 단위로 분리하고 각 줄을 JSON 객체로 파싱
                const dataLines = textData.trim().split('\n').map(line => JSON.parse(line));
                
                return dataLines;
            } catch (error) {
                console.error('데이터를 가져오거나 파싱하는 중 오류 발생:', error);
            }
        }

        // ApexCharts를 사용하여 차트를 생성하는 함수
        async function createChart() {
            const data = await fetchData();
            
            if (!data) {
                return;
            }

            // 라벨(날짜)과 데이터셋(BTC 가격, 잔액, USD 잔액) 추출
            const labels = data.map(item => new Date(item.day).toLocaleDateString());
            const btcPrices = data.map(item => item.BTC_price);
            const btcBalances = data.map(item => item.BTC_Balance);
            const usdBalances = data.map(item => item.USD_Balance);

            // 차트 생성
            const options = {
                chart: {
                    type: 'line',
                    height: 400
                },
                series: [
                    {
                        name: 'BTC 가격',
                        data: btcPrices
                    },
                    {
                        name: 'BTC 잔액',
                        data: btcBalances
                    },
                    {
                        name: 'USD 잔액',
                        data: usdBalances
                    }
                ],
                xaxis: {
                    categories: labels,
                    title: {
                        text: '날짜'
                    }
                },
                yaxis: {
                    title: {
                        text: '값'
                    }
                },
                stroke: {
                    curve: 'smooth'
                },
                title: {
                    text: '시간에 따른 BTC 가격, 잔액, USD 잔액',
                    align: 'center'
                }
            };

            const chart = new ApexCharts(document.querySelector("#btcChart"), options);
            chart.render();
        }

        // 페이지 로드 시 차트 생성
        createChart();
    </script>
</body>
</html>
